<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Simon Says â€” Strict</title>
<style>
  :root{
    --bg:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --accent:#22d3ee;
    --g:#16a34a; --r:#dc2626; --y:#ca8a04; --b:#2563eb;
    --g-lit:#34d399; --r-lit:#f87171; --y-lit:#facc15; --b-lit:#60a5fa;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100dvh;
    display:grid;
    place-content:center;
    gap:16px;
    font:500 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background:radial-gradient(1200px 900px at 50% -20%, #1f2937 0%, #0b1020 55%, #060913 100%);
    color:var(--ink);
    /* Safe-area friendly padding for iOS notches */
    padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
  }
  .wrap{
    width:min(560px, 96vw);
    margin-inline:auto;
    display:grid;
    gap:12px;
  }
  h1{margin:0; font-size:20px; font-weight:700; letter-spacing:.3px; text-align:center}

  .hud{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px; flex-wrap:wrap;
  }
  .left, .right{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
  .stat{
    padding:10px 12px; border-radius:12px; background:#0b1224;
    color:var(--ink); min-width:110px; text-align:center;
  }
  .stat small{display:block; color:var(--muted); font-weight:600; letter-spacing:.2px}
  .btn{
    appearance:none; border:none; border-radius:12px; padding:10px 14px;
    background:linear-gradient(180deg, #0ea5e9, #0284c7); color:white; font-weight:700;
    cursor:pointer; box-shadow:0 10px 18px rgba(2,132,199,.35); transition:transform .08s ease, filter .08s ease;
  }
  .btn:active{transform:translateY(1px)}

  .board{
    /* Square board scales to the smaller viewport dimension on phones */
    width:min(520px, 92vmin);
    margin-inline:auto;
    aspect-ratio:1 / 1;
    display:grid; grid-template-columns:repeat(2,1fr); gap:12px;
    border-radius:20px; padding:12px;
    background:#0b1224; box-shadow:0 20px 60px rgba(0,0,0,.45) inset, 0 10px 30px rgba(0,0,0,.35);
  }
  .pad{
    border-radius:18px; cursor:pointer; user-select:none; touch-action:manipulation;
    box-shadow:inset 0 0 0 3px rgba(255,255,255,.06), 0 10px 18px rgba(0,0,0,.35);
    transition:transform .08s ease, filter .08s ease, box-shadow .08s ease;
    position:relative; isolation:isolate;
  }
  .pad:active{transform:scale(.98)}
  .pad.disabled{pointer-events:none; filter:saturate(.6) brightness(.8)}
  .g{background:linear-gradient(180deg, var(--g), #0e7a35)}
  .r{background:linear-gradient(180deg, var(--r), #a31818)}
  .y{background:linear-gradient(180deg, var(--y), #916a05)}
  .b{background:linear-gradient(180deg, var(--b), #1b48b1)}
  .pad.lit.g{background:linear-gradient(180deg, var(--g-lit), #16a34a); box-shadow:0 0 24px 8px rgba(52,211,153,.55), inset 0 0 0 3px rgba(255,255,255,.12)}
  .pad.lit.r{background:linear-gradient(180deg, var(--r-lit), #dc2626); box-shadow:0 0 24px 8px rgba(248,113,113,.55), inset 0 0 0 3px rgba(255,255,255,.12)}
  .pad.lit.y{background:linear-gradient(180deg, var(--y-lit), #ca8a04); box-shadow:0 0 24px 8px rgba(250,204,21,.55), inset 0 0 0 3px rgba(255,255,255,.12)}
  .pad.lit.b{background:linear-gradient(180deg, var(--b-lit), #2563eb); box-shadow:0 0 24px 8px rgba(96,165,250,.55), inset 0 0 0 3px rgba(255,255,255,.12)}

  .msg{margin-top:2px; color:var(--muted); min-height:20px; text-align:center}

  @media (max-width:480px){
    .stat{min-width:96px; padding:8px 10px}
    .board{gap:10px; padding:10px; width:min(520px, 94vmin)}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Simon Says (Strict)</h1>

    <div class="hud">
      <div class="left">
        <button id="startRestart" class="btn" aria-live="polite">Start</button>
      </div>
      <div class="right">
        <div class="stat"><small>Round</small><span id="round">0</span></div>
        <div class="stat"><small>Score (Longest)</small><span id="score">0</span></div>
      </div>
    </div>

    <div class="board" id="board" aria-label="Game board">
      <button class="pad g" id="p0" data-id="0" aria-label="Green"></button>
      <button class="pad r" id="p1" data-id="1" aria-label="Red"></button>
      <button class="pad y" id="p2" data-id="2" aria-label="Yellow"></button>
      <button class="pad b" id="p3" data-id="3" aria-label="Blue"></button>
    </div>

    <div class="msg" id="msg">Press Start to begin. Strict mode is always on.</div>
  </div>

<script>
(() => {
  const pads = [...document.querySelectorAll('.pad')];
  const btn = document.getElementById('startRestart');
  const roundEl = document.getElementById('round');
  const scoreEl = document.getElementById('score');
  const msgEl = document.getElementById('msg');

  let sequence = [];
  let stepIndex = 0;
  let acceptingInput = false;
  let sessionId = 0;
  let best = 0;
  let hasStartedOnce = false;

  const AC = window.AudioContext || window.webkitAudioContext;
  const ctx = AC ? new AC() : null;
  const tones = [329.63, 261.63, 220.00, 196.00];

  function setButtonStarted(){
    if (!hasStartedOnce){
      hasStartedOnce = true;
      btn.textContent = 'Restart';
    }
  }

  function beep(idx, dur = 420, vol = 0.2) {
    if (!ctx) return;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine';
    o.frequency.value = tones[idx] || 440;
    g.gain.value = 0.0001;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    const t = ctx.currentTime;
    g.gain.exponentialRampToValueAtTime(vol, t + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, t + dur / 1000);
    o.stop(t + dur / 1000 + 0.02);
  }
  function setPadsDisabled(disabled){ pads.forEach(p => p.classList.toggle('disabled', disabled)); }
  function lightPad(idx, dur = 500){
    const el = document.getElementById('p' + idx);
    if (!el) return;
    el.classList.add('lit');
    beep(idx, dur);
    setTimeout(() => el.classList.remove('lit'), Math.max(150, dur - 60));
  }
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  async function playback(){
    acceptingInput = false;
    setPadsDisabled(true);
    const mySession = sessionId;
    msgEl.textContent = 'Watch the sequence.';
    const base = 520;
    const stepDur = Math.max(250, base - sequence.length * 12);
    await sleep(500);
    for (let i = 0; i < sequence.length; i++){
      if (mySession !== sessionId) return;
      lightPad(sequence[i], stepDur);
      await sleep(stepDur + 140);
    }
    if (mySession !== sessionId) return;
    stepIndex = 0;
    acceptingInput = true;
    setPadsDisabled(false);
    msgEl.textContent = 'Your turn.';
  }

  function updateRound(){ roundEl.textContent = String(sequence.length); }
  function updateScore(){ scoreEl.textContent = String(best); }
  function addRandomStep(){ sequence.push(Math.floor(Math.random() * 4)); updateRound(); }

  function resetGame(keepBest = false){
    sessionId++;
    sequence = [];
    stepIndex = 0;
    acceptingInput = false;
    if (!keepBest) best = 0;
    updateRound(); updateScore();
    setPadsDisabled(true);
    msgEl.textContent = hasStartedOnce ? 'Press Restart to play again.' : 'Press Start to begin. Strict mode is always on.';
    if (!hasStartedOnce) btn.textContent = 'Start';
  }

  async function startGame(){
    // Make sure audio is unlocked on first gesture (iOS)
    if (ctx && ctx.state === 'suspended') { try { await ctx.resume(); } catch(e){} }
    setButtonStarted();
    sessionId++;
    stepIndex = 0;
    sequence = [];
    updateRound();
    setPadsDisabled(true);
    msgEl.textContent = 'Get ready.';
    await sleep(300);
    addRandomStep();
    await playback();
  }

  async function handleWrong(){
    acceptingInput = false;
    setPadsDisabled(true);
    msgEl.textContent = 'Wrong. Restarting.';
    pads.forEach(p => p.classList.add('lit'));
    if (ctx){
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type = 'sawtooth'; o.frequency.value = 110;
      g.gain.value = 0.0001; o.connect(g); g.connect(ctx.destination);
      const t = ctx.currentTime;
      o.start();
      g.gain.exponentialRampToValueAtTime(0.25, t + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t + 0.35);
      o.stop(t + 0.4);
    }
    await sleep(380);
    pads.forEach(p => p.classList.remove('lit'));
    await startGame(); // strict always restarts
  }

  async function handlePadPress(idx){
    if (!acceptingInput) return;
    lightPad(idx, 260);
    const expected = sequence[stepIndex];
    if (idx !== expected) return handleWrong();
    stepIndex++;
    if (stepIndex === sequence.length){
      best = Math.max(best, sequence.length);
      updateScore();
      acceptingInput = false;
      setPadsDisabled(true);
      msgEl.textContent = 'Nice. Next round.';
      await sleep(420);
      addRandomStep();
      await playback();
    }
  }

  pads.forEach(p => {
    p.addEventListener('click', () => handlePadPress(Number(p.dataset.id)));
    p.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' '){ e.preventDefault(); handlePadPress(Number(p.dataset.id)); }
    });
  });
  btn.addEventListener('click', startGame);

  // Initial state
  resetGame(false);
})();
</script>
</body>
</html>
